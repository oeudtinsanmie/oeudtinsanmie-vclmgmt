<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Strict//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>/media/oeudtinsanmie/Gramarye/svn/netlabs-puppet-modules/vclmgmt/.README.md.html</title>


<style type="text/css">
body {
	color: #333;
	font: 13px/1.4 Helvetica,arial,freesans,clean,sans-serif;
	font-family: sans-serif;
}

.markdown-body {
    border: 1px solid #CACACA;
    padding: 30px;
    font-size: 15px;
    line-height: 1.7;
    word-wrap: break-word;
}
.markdown-body > *:first-child {
    margin-top: 0 !important;
}
.markdown-body > *:last-child {
    margin-bottom: 0 !important;
}
.markdown-body a.absent {
    color: #C00;
}
.markdown-body a.anchor {
    bottom: 0;
    cursor: pointer;
    display: block;
    left: 0;
    margin-left: -30px;
    padding-left: 30px;
    padding-right: 6px;
    position: absolute;
    top: 0;
}
.markdown-body a.anchor:focus {
    outline: medium none;
}
.markdown-body h1, .markdown-body h2, .markdown-body h3, .markdown-body h4, .markdown-body h5, .markdown-body h6 {
    cursor: text;
    font-weight: bold;
    line-height: 1.7;
    margin: 1em 0 15px;
    padding: 0;
    position: relative;
}

.markdown-body h1 .octicon-link, .markdown-body h2 .octicon-link, .markdown-body h3 .octicon-link, .markdown-body h4 .octicon-link, .markdown-body h5 .octicon-link, .markdown-body h6 .octicon-link {
    color: #000;
    display: none;
}
.markdown-body h1:hover a.anchor, .markdown-body h2:hover a.anchor, .markdown-body h3:hover a.anchor, .markdown-body h4:hover a.anchor, .markdown-body h5:hover a.anchor, .markdown-body h6:hover a.anchor {
    line-height: 1;
    margin-left: -22px;
    padding-left: 0;
    text-decoration: none;
    top: 15%;
}
.markdown-body h1:hover a.anchor .octicon-link, .markdown-body h2:hover a.anchor .octicon-link, .markdown-body h3:hover a.anchor .octicon-link, .markdown-body h4:hover a.anchor .octicon-link, .markdown-body h5:hover a.anchor .octicon-link, .markdown-body h6:hover a.anchor .octicon-link {
    display: inline-block;
}
.markdown-body h1 tt, .markdown-body h1 code, .markdown-body h2 tt, .markdown-body h2 code, .markdown-body h3 tt, .markdown-body h3 code, .markdown-body h4 tt, .markdown-body h4 code, .markdown-body h5 tt, .markdown-body h5 code, .markdown-body h6 tt, .markdown-body h6 code {
    font-size: inherit;
}
.markdown-body h1 {
    border-bottom: 1px solid #DDD;
    font-size: 2.5em;
}
.markdown-body h2 {
    border-bottom: 1px solid #EEE;
    font-size: 2em;
}
.markdown-body h3 {
    font-size: 1.5em;
}
.markdown-body h4 {
    font-size: 1.2em;
}
.markdown-body h5 {
    font-size: 1em;
}
.markdown-body h6 {
    color: #777;
    font-size: 1em;
}
.markdown-body p, .markdown-body blockquote, .markdown-body ul, .markdown-body ol, .markdown-body dl, .markdown-body table, .markdown-body pre {
    margin: 15px 0;
}
.markdown-body hr {
    background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC") repeat-x;
    border: 0;
    color: #CCC;
    height: 4px;
    margin: 15px 0;
    padding: 0;
}
.markdown-body ul, .markdown-body ol {
    padding-left: 30px;
}
.markdown-body ul.no-list, .markdown-body ol.no-list {
    list-style-type: none;
    padding: 0;
}
.markdown-body ul ul, .markdown-body ul ol, .markdown-body ol ol, .markdown-body ol ul {
    margin-bottom: 0;
    margin-top: 0;
}
.markdown-body dl {
    padding: 0;
}
.markdown-body dl dt {
    font-size: 14px;
    font-style: italic;
    font-weight: bold;
    margin-top: 15px;
    padding: 0;
}
.markdown-body dl dd {
    margin-bottom: 15px;
    padding: 0 15px;
}
.markdown-body blockquote {
    border-left: 4px solid #DDD;
    color: #777;
    padding: 0 15px;
}
.markdown-body blockquote > *:first-child {
    margin-top: 0;
}
.markdown-body blockquote > *:last-child {
    margin-bottom: 0;
}
.markdown-body table {
    display: block;
    overflow: auto;
    width: 100%;
    border-collapse: collapse;
}
.markdown-body table th {
    font-weight: bold;
}
.markdown-body table th, .markdown-body table td {
    border: 1px solid #DDD;
    padding: 6px 13px;
}
.markdown-body table tr {
    background-color: #FFF;
    border-top: 1px solid #CCC;
}
.markdown-body table tr:nth-child(2n) {
    background-color: #F8F8F8;
}
.markdown-body img {
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    -o-box-sizing: border-box;
    box-sizing: border-box;
    max-width: 100%;
    border: 0px;
}
.markdown-body span.frame {
    display: block;
    overflow: hidden;
}
.markdown-body span.frame > span {
    border: 1px solid #DDD;
    display: block;
    float: left;
    margin: 13px 0 0;
    overflow: hidden;
    padding: 7px;
    width: auto;
}
.markdown-body span.frame span img {
    display: block;
    float: left;
}
.markdown-body span.frame span span {
    clear: both;
    color: #333;
    display: block;
    padding: 5px 0 0;
}
.markdown-body span.align-center {
    clear: both;
    display: block;
    overflow: hidden;
}
.markdown-body span.align-center > span {
    display: block;
    margin: 13px auto 0;
    overflow: hidden;
    text-align: center;
}
.markdown-body span.align-center span img {
    margin: 0 auto;
    text-align: center;
}
.markdown-body span.align-right {
    clear: both;
    display: block;
    overflow: hidden;
}
.markdown-body span.align-right > span {
    display: block;
    margin: 13px 0 0;
    overflow: hidden;
    text-align: right;
}
.markdown-body span.align-right span img {
    margin: 0;
    text-align: right;
}
.markdown-body span.float-left {
    display: block;
    float: left;
    margin-right: 13px;
    overflow: hidden;
}
.markdown-body span.float-left span {
    margin: 13px 0 0;
}
.markdown-body span.float-right {
    display: block;
    float: right;
    margin-left: 13px;
    overflow: hidden;
}
.markdown-body span.float-right > span {
    display: block;
    margin: 13px auto 0;
    overflow: hidden;
    text-align: right;
}
.markdown-body code, .markdown-body tt {
    background-color: #F8F8F8;
    border: 1px solid #DDD;
    border-radius: 3px;
    margin: 0 2px;
    padding: 0 5px;
}
.markdown-body code {
    white-space: nowrap;
}
.markdown-body pre > code {
    border: medium none;
    margin: 0;
    padding: 0;
    white-space: pre;
}
.markdown-body .highlight pre, .markdown-body pre {
    background-color: #F8F8F8;
    border: 1px solid #DDD;
    border-radius: 3px;
    font-size: 13px;
    line-height: 19px;
    overflow: auto;
    padding: 6px 10px;
}
.markdown-body pre code, .markdown-body pre tt {
    border: medium none;
    margin: 0;
    padding: 0;
    word-wrap: normal;
}

pre, code, tt {
    font-family: Consolas,"Liberation Mono",Courier,monospace;
    font-size: 12px;
}

.highlight {
    background: #FFF;
}
.highlight .k,
.highlight .o,
.highlight .cp,
.highlight .cs,
.highlight .gs,
.highlight .gu,
.highlight .kc,
.highlight .kd,
.highlight .kn,
.highlight .kp,
.highlight .kr,
.highlight .kt,
.highlight .nc,
.highlight .ne,
.highlight .nf,
.highlight .ow {
    font-weight: bold;
}
.highlight .gd,
.highlight .gd .x,
.highlight .gi,
.highlight .gi .x,
.type-csharp .highlight .nf,
.type-csharp .highlight .nn {
    color: #000;
}
.highlight .c,
.highlight .cm,
.highlight .c1 {
    color: #998;
    font-style: italic;
}
.highlight .err {
    background-color: #E3D2D2;
    color: #A61717;
}
.highlight .cp,
.highlight .cs {
    color: #999;
}
.highlight .cs,
.highlight .ge {
    font-style: italic;
}
.highlight .gd {
    background-color: #FDD;
}
.highlight .gd .x {
    background-color: #FAA;
}
.highlight .gr,
.highlight .gt {
    color: #A00;
}
.highlight .gh {
    color: #999;
}
.highlight .gi {
    background-color: #DFD;
}
.highlight .gi .x {
    background-color: #AFA;
}
.highlight .go {
    color: #888;
}
.highlight .gp,
.highlight .nn {
    color: #555;
}
.highlight .gu,
.highlight .ni {
    color: #800080;
}
.highlight .kt {
    color: #458;
}
.highlight .m {
    color: #099;
}
.highlight .s {
    color: #D14;
}
.highlight .n {
    color: #333;
}
.highlight .na,
.highlight .no,
.highlight .nv,
.highlight .vc,
.highlight .vg,
.highlight .vi {
    color: #008080;
}
.highlight .nb {
    color: #0086B3;
}
.highlight .nc {
    color: #458;
}
.highlight .ne,
.highlight .nf {
    color: #900;
}
.highlight .nt {
    color: #000080;
}
.highlight .w {
    color: #BBB;
}
.highlight .mf,
.highlight .mh,
.highlight .mi,
.highlight .mo {
    color: #099;
}
.highlight .sb,
.highlight .sc,
.highlight .sd,
.highlight .s2,
.highlight .se,
.highlight .sh,
.highlight .si,
.highlight .sx,
.highlight .s1 {
    color: #D14;
}
.highlight .sr {
    color: #009926;
}
.highlight .ss {
    color: #990073;
}
.highlight .bp {
    color: #999;
}
.highlight .il {
    color: #099;
}
.highlight .gc {
    background-color: #EAF2F5;
    color: #999;
}
.type-csharp .highlight .k,
.type-csharp .highlight .kt {
    color: #00F;
}
.type-csharp .highlight .nf {
    font-weight: normal;
}
.type-csharp .highlight .nc {
    color: #2B91AF;
}
.type-csharp .highlight .s,
.type-csharp .highlight .sc {
    color: #A31515;
}

</style>


<script type="text/javascript">

function getDocumentScrollTop() 
{
   var res = document.body.scrollTop || document.documentElement.scrollTop || window.pageYOffset || 0;
   // alert(res);
   return res;
}

function setDocumentScrollTop(ypos) 
{
	window.scrollTo(0, ypos);
}

</script>


</head>
<body class="markdown-body">
<h1> <a name="vcl-managment-module" class="anchor" href="#vcl-managment-module" aria-hidden="true"><span class="octicon octicon-link"></span></a>VCL Managment Module</h1> 
<p>This module installs and configures xCAT and VCL, and profides puppet classes to manipulate the related xCAT and database tables VCL uses. The current version supports VCL up to release-2.3.2-RC2. Development is in process to support the new database schema in the upcoming release of 2.4. xCAT installation and resource management use the related <a href="https://github.ncsu.edu/engr-csc-netlabs/puppetmodules/tree/master/xcat">xCAT module</a>.</p> 
<h2> <a name="classes" class="anchor" href="#classes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Classes</h2> 
<ul> 
 <li><a href="#vclmgmt-">Vclmgmt</a></li> 
 <li><a href="#vclmgmtxcat_pod-">Vclmgmt::Xcat_pod</a></li> 
 <li><a href="#vclmgmtxcat_vlan-">Vclmgmt::Xcat_vlan</a></li> 
 <li><a href="#vclmgmtcompute_node-">Vclmgmt::Compute_node</a></li> 
 <li><a href="#vclmgmtbaseimage-">Vclmgmt::Baseimage</a></li> 
</ul>
<h2> <a name="hiera-usage--custom-functions" class="anchor" href="#hiera-usage--custom-functions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Hiera Usage &amp; Custom Functions</h2> 
<ul> 
 <li><a href="#example-yaml-">Hiera Yaml Example</a></li> 
 <li><a href="#set_defaults-usage-">Using the set_defaults Function</a></li> 
</ul>
<h1> <a name="class-definitions" class="anchor" href="#class-definitions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Class Definitions</h1> 
<h2> <a name="vclmgmt-" class="anchor" href="#vclmgmt-" aria-hidden="true"><span class="octicon octicon-link"></span></a>vclmgmt </h2> 
<p>Installs xCAT and VCL from source, then configures the management node. You can also include an array of hashes describing the vclmgmt::xcat_pod configurations for client subnets. Pod configurations will inherit the private and impi mac addreses and interface names, by default. Explicit definitions within the pods hash will override those defaults. Chaining rules for vclmgmt classes with relation to the installation and xcat are also defined.</p> 
<pre><code>class { &quot;vclmgmt&quot; :
    # public network parameters
    public_mac     =&gt; 'XX:XX:XX:XX:XX:XX',   # MAC address for public network interface                 (REQUIRED)
    public_if      =&gt; 'em1',                 # Interface name of public-network facing interface.       (default value)
    public_ip      =&gt; 'dhcp',                # IP address for public-network facing interface           (default value)

    # private network parameters (network for provisioning target computers)                            
    private_mac    =&gt; 'XX:XX:XX:XX:XX:XX',   # MAC address for private-network facing interface         (REQUIRED)   
    private_if     =&gt; 'em2',                 # Interface name of private-network facing interface       (default value)
    private_ip     =&gt; '172.20.0.1',          # IP address for private-network facing interface          (REQUIRED)
    private_domain =&gt; 'mydomain',            # Domain for private-network facing interface              (REQUIRED)

    # ipmi network parameters (connected to DRACs of target computers)
    ipmi_mac       =&gt; 'XX:XX:XX:XX:XX:XX',   # MAC address for ipmi-network facing interface            (REQUIRED)
    ipmi_if        =&gt; 'p4p1',                # Interface name of ipmi-network facing interface          (default value)
    ipmi_ip        =&gt; '172.25.0.1',          # IP address for ipmi-network facing interface             (REQUIRED)

    # database setup
    vcldb          =&gt; 'vcl',                 # Database used by vcl                                     (default value)
    vcluser        =&gt; 'vcluser@localhost',   # Database user for vcl                                    (default value)
    root_pw        =&gt; 'ANOTHER_PASSWORD',    # Database root password                                   (REQUIRED)
    vcluser_pw     =&gt; 'PASSWORD',            # Database vcl user password                               (REQUIRED)

    system_user    =&gt; 'root',                # Admin account used in provisioned computers              (default value)
    system_pw,                               # Password for root accout in provisioned computers        (REQUIRED)
    vclhost        =&gt; 'localhost',           # Address of vcl webface                                   (default value)
    serverip       =&gt; 'localhost',           # Address of vcl database                                  (default value)

    # Required for block reservation processing
    xmlrpc_user    =&gt; 'admin',               # must be the unityid field for a user in the user table   (default value)
    xmlrpc_pw,                               # Password for xmlrpc_user.                                (default value)  
                                             # This parameter does not set the password.  It only fills out the vcld configuration file, so you can leave this default until you want to use block reservation processing and have set up a user for this purpose.
    xml_url,                                 # URL used to call block reservations                      (default value)
                                             #
                                             # From VCL documentation: the URL will be the URL of your VCL website with a few things on the end
                                             # for example, if you install the VCL web code at https://vcl.example.org/vcl/
                                             # set xmlrpc_url to https://vcl.example.org/vcl/index.php?mode=xmlrpccall
                                             # Defaults to &quot;https://$fqdn/vcl/index.php?mode=xmlrpccall&quot; 

    poddefaults    =&gt; {},                    # Default values applied to pod hashes supplied in the class definition.  Pod values take precedence over poddefaults, which take precedence over defaults derived from the management node definition
    pods           =&gt; undef,                 # Hashes defining public/private/ipmi tuples (pods) supported by this management node.  If not undef, these hashes will be populated with default values from the management node and declared as puppet resources

    vcldir         =&gt; '/vcl',                # Directory in which to place vcl svn repo                 (default value)
    dojo           =&gt; '1.6.1',               # Dojo version                                             (default value)
    dojo_checksum  =&gt; false,                 # Whether to look for an MD5 Checksum for dojo archive     (default value)
    vclweb         =&gt; '/var/www/html/vcl',   # VCL web folder location                                  (default value)
    vclnode        =&gt; '/usr/local/vcl',      # Alias within standard path for vcl directory             (default value)

    firewalldefaults  =&gt; {                   # Set pre and post class requirements for the firewall declarations  (default value)
        require  =&gt;&gt; Class['ncsufirewall::pre'],
        before   =&gt;&gt; Class['ncsufirewall::post'],
    },

    vclversion  =&gt; &quot;release-2.3.2-RC2&quot;,      # The release of vcl to pull from the repo, or &quot;latest&quot; if you want to work with the trunk  (default value)
    vclrevision  =&gt; undef,                   # If defined, pulls a specific revision of the vcl subversion repo                          (default value)

}
</code></pre> 
<h2> <a name="vclmgmtxcat_pod-" class="anchor" href="#vclmgmtxcat_pod-" aria-hidden="true"><span class="octicon octicon-link"></span></a>vclmgmt::xcat_pod </h2> 
<p>Describes the private and ipmi subnets for a given collection of compute nodes. It accepts hashes defining the xcat_vlan objects for its private and ipmi subnets, as well as a defaults hash, which may be used to contain any values shared by both definitions. In addition, you may include a hash describing the compute_node objects of this pod. Compute nodes within this list will be passed definitions from the pod within their defaults hash, describing the private and ipmi interfaces, networks and domains. These will be overridden by any explicit definition in the compute_node hashes.</p> 
<pre><code>vclmgmt::xcat_pod { &quot;pod7a&quot; : 
    private_hash =&gt; {                         # An xcat_vlan hash for the private network
        vlan_alias_ip =&gt; '192.168.37.1',
        network       =&gt; '192.168.37.0',
        netmask       =&gt; '255.255.255.192',
        domain        =&gt; 'mydomain',
        vlanid        =&gt; '307',
    },
    ipmi_hash =&gt; {                            # An xcat_vlan hash for the ipmi network
        network       =&gt; '192.168.137.0',
        netmask       =&gt; '255.255.255.192',
        domain        =&gt; 'ipmidomain',
        vlanid        =&gt; '1307',
    },
    defaults =&gt; {                             # Default values for node definitions within the nodes hash, if defined
        tgt_if        =&gt; 'eth1',      
        ipmi_user     =&gt; 'SOMEUSR',   
        ipmi_pw       =&gt; 'SOMEPASS',  
        admin_user    =&gt; 'adminuser', 
        admin_pw      =&gt; 'adminpass', 
    },
    nodes =&gt; {                                # Hash of vclmgmt::compute_nodes to declare with this network pair's settings
        &quot;my-node&quot; =&gt; {
            tgt_ip =&gt; &quot;192.168.37.8&quot;,
            ipmi_ip =&gt; &quot;192.168.137.8&quot;,
            tgt_mac =&gt; &quot;XX:XX:XX:XX:XX:XX&quot;,
            ipmi_mac =&gt; &quot;XX:XX:XX:XX:XX:XX&quot;,
        },
    },
  }
</code></pre> 
<h2> <a name="vclmgmtxcat_vlan-" class="anchor" href="#vclmgmtxcat_vlan-" aria-hidden="true"><span class="octicon octicon-link"></span></a>vclmgmt::xcat_vlan </h2> 
<p>Creates an xcat network object in xcat describing the network. If vlan_alias_ip is not undefined, it will also create a network interface for the vlan.</p> 
<pre><code>vclmgmt::xcat_vlan { &quot;some_network&quot; :
    master_if     =&gt; 'eth0', 
    master_mac    =&gt; 'XX:XX:XX:XX:XX:XX',   # MAC address for network interface
    master_ip     =&gt; '192.168.37.1',        # IP address for xcat management node on master_if
    vlan_alias_ip =&gt; undef,                 # IP address for xcat management node on the subnet routed through this vlan, or undef if no vlan is used                 
    domain        =&gt; 'mydomain',            # the domain name for this network
    network       =&gt; '192.168.37.0'         # network root address  
    netmask       =&gt; '255.255.255.192',     # netmask for network
    vlanid        =&gt; undef,                 # vlan id, if defining a subnet isolated by a vlan on this interface.  Ignored if no vlan_alias_ip provided
}
</code></pre> 
<h2> <a name="vclmgmtcompute_node-" class="anchor" href="#vclmgmtcompute_node-" aria-hidden="true"><span class="octicon octicon-link"></span></a>vclmgmt::compute_node </h2> 
<p>Defines related vcl_computer and xcat_node objects for a provision controlled computer. Vcl_computer is a defined type within the vclmgmt module and manages <a href="https://vcl.apache.org/dev/database-schema.html#computer-table">VCL Database Tables</a> related to computers, whereas xcat_node is a defined type within the related <a href="https://github.ncsu.edu/engr-csc-netlabs/puppetmodules/tree/master/xcat#xcat-objects-">xCAT module</a>. Where the computer table uses foreign keys to store properties of the computer, Vcl_computer abstracts this out. For example, if I made an image called 'centos65' that I wish to load on this computer, I would simply put its name in the image field.</p> 
<pre><code>vclmgmt::compute_node { &quot;my-node&quot; :
    ensure        =&gt; present,                       # Passthrough for ensurable objects in this class
    hostname      =&gt; $title,                        # Allows names of objects to be different from title of this resource
    public_ip,                                      # IP address for this computer on the public network
    public_mac,                                     # MAC address of this computer's interface on the public network 
    private_ip    =&gt; '192.168.37.8',                # IP address for target node on private network 
    private_mac   =&gt; 'XX:XX:XX:XX:XX:XX',           # MAC address for private network interface 
    private_if    =&gt; 'eth1',                        # interface of target node connected to its private network arget node
    ipmi_ip       =&gt; '192.168.137.8',               # IP address for target node on ipmi network 
    ipmi_mac      =&gt; 'XX:XX:XX:XX:XX:XX',           # MAC address for ipmi network interface 
    ipmi_user     =&gt; 'SOMEUSR',                     # username for ipmi on target node 
    ipmi_pw       =&gt; 'SOMEPASS',                    # password for ipmi on target node 
    master_ip,                                      # IP Address of management node (For the private network interface, not its vlan alias)
    xcat_groups   =&gt; [ 'ipmi', 'compute', 'all' ],  # Groups to add this computer to within xCAT
    vcl_groups    =&gt; [ 'allComputers' ],            # Groups to add this computer to within VCL. Valid groups are 'allComputers', 'All VM Computers'
    tgt_os        =&gt; 'centos',                      # OS to provision this computer with 
    tgt_arch      =&gt; 'x86_64',                      # Architecture of target node. 
    profile,                                        # Profile to apply when provisioning this computer
    username      =&gt; 'adminuser',                   # username to create as administrator on target node 
    password      =&gt; 'adminpass',                   # password for administrator account on target node
    netboot       =&gt; 'pxe',                         # Netboot method for provisioning
    provmethod    =&gt; 'install',                     # Provisioning method

    # vcl_computer parameters default to undef -&gt; inherits defaults from vcl_computer
    ram           =&gt; undef,                         # Amount of RAM in this computer 
    procnumber    =&gt; undef,                         # Number of processors on this computer
    procspeed     =&gt; undef,                         # Processor speed of this computer
    network       =&gt; undef,                         # Network speed of this computer
    type          =&gt; undef,                         # Type of this computer. Valid values are blade, lab, or virtualmachine
    drivetype     =&gt; undef,                         # Type of hard drives within this computer. drivetype must be 4 or fewer chars. Default is hda
    deleted       =&gt; undef,                         # Whether this computer record should be marked deleted within the database
    notes         =&gt; undef,                         # Notes for this computer
    location      =&gt; undef,                         # Physical location of this computer

    # Not currently being used by VCL, according to documentation.  Was supposed to be for ssh
    dsa           =&gt; undef,                         
    dsapub        =&gt; undef,                         
    rsa           =&gt; undef,                          
    rsapub        =&gt; undef,                          
    hostpub       =&gt; undef,                          

    platform      =&gt; undef,                         # VCL platform designation of this computer. Valid values are i386, i386_lab, or ultrasparc
    vclschedule   =&gt; undef,                         # Schedule to assign this computer within VCL
    image         =&gt; undef,                         # Name of image to assign this computer
    imagerevision =&gt; undef,                         # Image revision number to assign this computer
    provisioning  =&gt; undef,                         # Provisioning method for this computer
    vmhost        =&gt; undef,                         # VM Host of this computer
    vmtype        =&gt; undef,                         # VM Type of this computer
}
</code></pre> 
<h2> <a name="vclmgmtbaseimage-" class="anchor" href="#vclmgmtbaseimage-" aria-hidden="true"><span class="octicon octicon-link"></span></a>vclmgmt::baseimage </h2> 
<p>Creates the database rows for a vcl base image, and creates an image within xcat, using the <a href="https://github.ncsu.edu/engr-csc-netlabs/puppetmodules/tree/master/xcat#xcat-objects-">xcat::image</a> class. Some of these parameters are enumerations from the Apache VCL project. With the exception of the os code, everything else should work using only the default values. If your configuration needs non-default values, refer to <a href="https://vcl.apache.org/dev/database-schema.html#image-table">VCL documentation</a> for more details.</p> 
<pre><code>vclmgmt::baseimage { &quot;base-img&quot; :
    ensure        =&gt; present,                   # Passthrough for ensurable objects in this class
    prettyname    =&gt; &quot;Base Image Name&quot;,         # Long display name for this image in VCL
    platform      =&gt; 'i386',                    # VCL platform attribution for this image (may be i386, i386_lab, or ultrasparc)
    os            =&gt; 'centos5',                 # OS of this image 
    minram        =&gt; 512,                       # Min RAM requirement for this image
    minprocnumber =&gt; 1,                         # Min number of processors requirement for this image
    minprocspeed  =&gt; 1024,                      # Min processor speed requirement for this image
    minnetwork    =&gt; 100,                       # Min network speed requirement for this image
    maxconcurrent =&gt; undef,                     # maximum concurrent reservations that can be made for image
    test          =&gt; false,                     # flag to show if there is a test version of this image available (depricated?)        
    forcheckout   =&gt; true,                      # Assign this image for checkout
    project       =&gt; 'vcl',                     # Project within which this image is available. Valid values are vcl, hpc, or vclhpc
    size          =&gt; 1500,                      # Size of this image
    architecture  =&gt; 'x86_64',                  # Architecture this image targets. Valid values are x86 or x86_64
    description   =&gt; undef,                     # Description for this image 
    usage         =&gt; undef,                     # notes on how to use image displayed on Connect page
    deleted       =&gt; false,                     # Whether this image should be marked deleted

    # Parameters for the xcat::image class.  The architecture parameter, above, is used for xcat::image -&gt; arch.
    url           =&gt; undef,                     # URL from which to download the iso for this image
    filepath      =&gt; '/images/baseimg.iso',     # File location of the iso for this image
    distro        =&gt; &quot;centos6.5&quot;,               # OS distribution identifier of this image
}
</code></pre> 
<p>Here are the os codes currently available:</p> 
<table> 
 <thead>
  <tr> 
   <th>name</th> 
   <th>prettyname</th> 
   <th>type</th> 
   <th>installtype</th> 
  </tr>
 </thead> 
 <tbody> 
  <tr> 
   <td>sun4x_58</td> 
   <td>Solaris 5.8 (Lab)</td> 
   <td>unix</td> 
   <td>none</td> 
  </tr> 
  <tr> 
   <td>win2k</td> 
   <td>Windows 2000 (Bare Metal)</td> 
   <td>windows</td> 
   <td>partimage</td> 
  </tr> 
  <tr> 
   <td>rhel3</td> 
   <td>Red Hat Enterprise Linux 3 (Kickstart)</td> 
   <td>linux</td> 
   <td>kickstart</td> 
  </tr> 
  <tr> 
   <td>winxp</td> 
   <td>Windows XP (Bare Metal)</td> 
   <td>windows</td> 
   <td>partimage</td> 
  </tr> 
  <tr> 
   <td>realmrhel3</td> 
   <td>Red Hat Enterprise Linux 3 (Lab)</td> 
   <td>linux</td> 
   <td>none</td> 
  </tr> 
  <tr> 
   <td>realmrhel4</td> 
   <td>Red Hat Enterprise Linux 4 (Lab)</td> 
   <td>linux</td> 
   <td>none</td> 
  </tr> 
  <tr> 
   <td>win2003</td> 
   <td>Windows 2003 Server (Bare Metal)</td> 
   <td>windows</td> 
   <td>partimage</td> 
  </tr> 
  <tr> 
   <td>rh3image</td> 
   <td>Red Hat Enterprise Linux 3 (Bare Metal)</td> 
   <td>linux</td> 
   <td>partimage</td> 
  </tr> 
  <tr> 
   <td>rhel4</td> 
   <td>Red Hat Enterprise Linux 4 (Kickstart)</td> 
   <td>linux</td> 
   <td>kickstart</td> 
  </tr> 
  <tr> 
   <td>rh4image</td> 
   <td>Red Hat Enterprise Linux 4 (Bare Metal)</td> 
   <td>linux</td> 
   <td>partimage</td> 
  </tr> 
  <tr> 
   <td>fc5image</td> 
   <td>Fedora Core 5 (Bare Metal)</td> 
   <td>linux</td> 
   <td>partimage</td> 
  </tr> 
  <tr> 
   <td>rhfc5</td> 
   <td>Fedora Core 5 (Kickstart)</td> 
   <td>linux</td> 
   <td>kickstart</td> 
  </tr> 
  <tr> 
   <td>vmwarewinxp</td> 
   <td>Windows XP (VMware)</td> 
   <td>windows</td> 
   <td>vmware</td> 
  </tr> 
  <tr> 
   <td>rhfc7</td> 
   <td>Fedora Core 7 (Kickstart)</td> 
   <td>linux</td> 
   <td>kickstart</td> 
  </tr> 
  <tr> 
   <td>fc7image</td> 
   <td>Fedora Core 7 (Bare Metal)</td> 
   <td>linux</td> 
   <td>partimage</td> 
  </tr> 
  <tr> 
   <td>rhel5</td> 
   <td>Red Hat Enterprise Linux 5 (Kickstart)</td> 
   <td>linux</td> 
   <td>kickstart</td> 
  </tr> 
  <tr> 
   <td>esx35</td> 
   <td>VMware ESX 3.5 (Kickstart)</td> 
   <td>linux</td> 
   <td>kickstart</td> 
  </tr> 
  <tr> 
   <td>vmwareesxwinxp</td> 
   <td>Windows XP (VMware ESX)</td> 
   <td>windows</td> 
   <td>vmware</td> 
  </tr> 
  <tr> 
   <td>realmrhel5</td> 
   <td>Red Hat Enterprise Linux 5 (Lab)</td> 
   <td>linux</td> 
   <td>none</td> 
  </tr> 
  <tr> 
   <td>sun4x_510</td> 
   <td>Solaris 10 (Lab)</td> 
   <td>unix</td> 
   <td>none</td> 
  </tr> 
  <tr> 
   <td>centos5</td> 
   <td>CentOS 5 (Kickstart)</td> 
   <td>linux</td> 
   <td>kickstart</td> 
  </tr> 
  <tr> 
   <td>rh5image</td> 
   <td>Red Hat Enterprise Linux 5 (Bare Metal)</td> 
   <td>linux</td> 
   <td>partimage</td> 
  </tr> 
  <tr> 
   <td>rhfc9</td> 
   <td>RedHat Fedora Core 9 (Kickstart)</td> 
   <td>linux</td> 
   <td>kickstart</td> 
  </tr> 
  <tr> 
   <td>fc9image</td> 
   <td>Red Hat Fedora Core 9 (Bare Metal)</td> 
   <td>linux</td> 
   <td>partimage</td> 
  </tr> 
  <tr> 
   <td>winvista</td> 
   <td>Windows Vista (Bare Metal)</td> 
   <td>windows</td> 
   <td>partimage</td> 
  </tr> 
  <tr> 
   <td>centos5image</td> 
   <td>CentOS 5 (Bare Metal)</td> 
   <td>linux</td> 
   <td>partimage</td> 
  </tr> 
  <tr> 
   <td>ubuntuimage</td> 
   <td>Ubuntu (Bare Metal)</td> 
   <td>linux</td> 
   <td>partimage</td> 
  </tr> 
  <tr> 
   <td>vmwarewin2008</td> 
   <td>Windows Server 2008 (VMware)</td> 
   <td>windows</td> 
   <td>vmware</td> 
  </tr> 
  <tr> 
   <td>win2008</td> 
   <td>Windows Server 2008 (Bare Metal)</td> 
   <td>windows</td> 
   <td>partimage</td> 
  </tr> 
  <tr> 
   <td>vmwarewinvista</td> 
   <td>Windows Vista (VMware)</td> 
   <td>windows</td> 
   <td>vmware</td> 
  </tr> 
  <tr> 
   <td>win7</td> 
   <td>Windows 7 (Bare Metal)</td> 
   <td>windows</td> 
   <td>partimage</td> 
  </tr> 
  <tr> 
   <td>vmwarewin7</td> 
   <td>Windows 7 (VMware)</td> 
   <td>windows</td> 
   <td>vmware</td> 
  </tr> 
  <tr> 
   <td>vmwarelinux</td> 
   <td>Generic Linux (VMware)</td> 
   <td>linux</td> 
   <td>vmware</td> 
  </tr> 
  <tr> 
   <td>vmwarewin2003</td> 
   <td>Windows 2003 Server (VMware)</td> 
   <td>windows</td> 
   <td>vmware</td> 
  </tr> 
  <tr> 
   <td>esxi4.1</td> 
   <td>VMware ESXi 4.1</td> 
   <td>linux</td> 
   <td>kickstart</td> 
  </tr> 
  <tr> 
   <td>vmwareosx</td> 
   <td>OSX Snow Leopard (VMware)</td> 
   <td>osx</td> 
   <td>vmware</td> 
  </tr> 
  <tr> 
   <td>rhel6</td> 
   <td>Red Hat Enterprise 6 (Kickstart)</td> 
   <td>linux</td> 
   <td>kickstart</td> 
  </tr> 
  <tr> 
   <td>rh6image</td> 
   <td>Red Hat Enterprise 6 (Bare Metal)</td> 
   <td>linux</td> 
   <td>partimage</td> 
  </tr> 
  <tr> 
   <td>fedora16</td> 
   <td>Fedora 16 (Kickstart)</td> 
   <td>linux</td> 
   <td>kickstart</td> 
  </tr> 
  <tr> 
   <td>fedoraimage</td> 
   <td>Fedora 16 (Bare Metal)</td> 
   <td>linux</td> 
   <td>partimage</td> 
  </tr> 
  <tr> 
   <td>vmwareubuntu</td> 
   <td>Ubuntu (VMware)</td> 
   <td>linux</td> 
   <td>vmware</td> 
  </tr> 
 </tbody> 
</table>
<h1> <a name="hiera-usage" class="anchor" href="#hiera-usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Hiera Usage</h1> 
<p>vclmgmt::xcat_pod and vclmgmt::compute_node are set up as a hierarcy. This makes it easy to define values in hiera once and let those definitions cascade through. Variables are passed down the hierarchy as default values for lower member classes, but may be overridden by explicit definitions. The simplest way to do this is to define all your networks and nodes in a hash within the vclmgmt class definition. You can use Puppet's automatic variable importing or define a hash and then declare a class resource with that hash. Alternatively, you might want to define a hash-generating function that defines network addresses according to some scheme (eg. by lab room, rack number, etc). In that case, you may use the set_defaults function discussed below to recreate the hierarchy inheritance of the main class for your generated hashes.</p> 
<h2> <a name="example-yaml-" class="anchor" href="#example-yaml-" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example Yaml </h2> 
<p>The nested hash structure and default-passing behavior of these puppet classes simplify defining a VCL installation in hiera, and then using the hiera_include, ensure_resource and create_resources functions. </p> 
<pre><code>---
mgmt_node:
    vcluser_pw: &quot;vcl_sql_password&quot;
    root_pw: &quot;root_sql_password&quot;
    ipmi_mac: &quot;XX:XX:XX:XX:XX:XX&quot;
    private_mac: &quot;XX:XX:XX:XX:XX:XX&quot;
    public_mac: &quot;XX:XX:XX:XX:XX:XX&quot;
    private_if: &quot;em2&quot;
    private_ip: &quot;192.168.0.5&quot;
    private_domain: &quot;mydomain&quot;
    ipmi_if: &quot;p4p1&quot;
    ipmi_ip: &quot;192.168.100.5&quot;
    pods:
        &quot;my-pod&quot;:
            private_hash:
                vlan_alias_ip: &quot;192.168.37.1&quot;
                network: &quot;192.168.37.0&quot;
                netmask: &quot;255.255.255.192&quot;
                domain: &quot;mypod.mydomain&quot;
                vlanid: &quot;XXX&quot;
            ipmi_hash:
                network: &quot;192.168.137.0&quot;
                netmask: &quot;255.255.255.192&quot;
                domain: &quot;ipmi.mypod.mydomain&quot;
                vlanid: &quot;YYY&quot;
            defaults:
                tgt_if: &quot;eth1&quot;
                ipmi_user: &quot;SOMEUSER&quot;
                ipmi_pw: &quot;SOMEPASS&quot;
                admin_user: &quot;AdminUser&quot;
                admin_pw: &quot;AdminPassword&quot;
            nodes:
                &quot;my-node1&quot;:
                    public_ip: xxx.xxx.xxx.xxx
                    private_ip: 192.168.37.8
                    ipmi_ip: 192.168.137.8
                    public_mac: XX:XX:XX:XX:XX:XX
                    private_mac: XX:XX:XX:XX:XX:XX
                    ipmi_mac: XX:XX:XX:XX:XX:XX
                    notes: &quot;My notes about this computer&quot;
                &quot;my-node2&quot;:
                    public_ip: xxx.xxx.xxx.xxx
                    private_ip: 192.168.37.72
                    ipmi_ip: 192.168.137.72
                    public_mac: XX:XX:XX:XX:XX:XX
                    private_mac: XX:XX:XX:XX:XX:XX
                    ipmi_mac: XX:XX:XX:XX:XX:XX
</code></pre> 
<h2> <a name="set_defaults-usage-" class="anchor" href="#set_defaults-usage-" aria-hidden="true"><span class="octicon octicon-link"></span></a>set_defaults Usage </h2> 
<p>The set_defaults function allows you to use the hierarchical default_passing behavior of the vclmgmt main class within your generated hash definitions. It takes three arguments: a pod definitons hash, a defaults hash and a management node hash. So, for example you could define your own pod definitions hash function of properties that describe your lab environment, and then use set_defaults to populate this generated hash with default values as if it were included within the vclmgmt class definition.</p> 
<pre><code>---
classes:
    - class where I defined my_generation_function

mgmt_node:
    vcluser_pw: vcl_sql_password
    root_pw: root_sql_password
    ipmi_mac: XX:XX:XX:XX:XX:XX
    private_mac: XX:XX:XX:XX:XX:XX
    public_mac: XX:XX:XX:XX:XX:XX
    private_if: em2
    private_ip: 192.168.0.5
    private_domain: mydomain
    ipmi_if: p4p1
    ipmi_ip: 192.168.100.5

my_nodes:
    lab1:
        pod1a:
            rack: 1
            sub: a
        nodes:
            node1a1:
                shelf: 1
                type: onetypewehave
            node1a2:
                shelf: 2
                type: anothertypewehave
            node1a3:
                shelf: 3
                type: onetypewehave
        pod2c:
            rack: 1
            sub: c
        nodes:
            node2c1:
                shelf: 1
                type: someothertype
            node2c2:
                shelf: 2
                type: onetypewehave

my_defaults:
    private_if: em2
    tgt_os: centos6.5
    profile: centos65-test
    ipmi_user: root
    ipmi_pw: MY_PASSWORD
</code></pre> 
<p>And then in puppet:</p> 
<pre><code>hiera_include('classes')

$mgmt_node = hiera_hash('mgmt_node')
ensure_resource('class', 'vclmgmt', $mgmt_node)

$mypods = hiera_hash('my_nodes', {})
$mydefaults = hiera_hash('my_defaults', {})
create_resources(vclmgmt::xcat_pod, set_defaults(my_generation_function($mypods), $mydefaults, $mgmt_node) )
</code></pre>
</body>
</html>
